package com.nikhil.phase3.service;

import java.lang.reflect.Type;
import java.util.List;

import org.modelmapper.ModelMapper;
import org.modelmapper.TypeToken;
import org.modelmapper.convention.MatchingStrategies;
import org.springframework.stereotype.Service;

import com.nikhil.phase3.dto.StockExchangeDto;
import com.nikhil.phase3.model.StockExchange;
import com.nikhil.phase3.repository.StockExchangeRepository;

@Service
public class StockExchangeServiceImpl implements StockExchangeService {

    private StockExchangeRepository stockExchangeRepo;
    private ModelMapper mapper;

    public StockExchangeServiceImpl(StockExchangeRepository stockExchangeRepository, ModelMapper modelMapper) {
        this.stockExchangeRepo = stockExchangeRepository;
        this.mapper = modelMapper;
    }

    @Override
    public Iterable<StockExchangeDto> getStockExchangesList() {
        mapper.getConfiguration().setMatchingStrategy(MatchingStrategies.STRICT);
        Type listType = new TypeToken<List<StockExchangeDto>>(){}.getType();
        List<StockExchangeDto> stockExchangeDtoList = mapper.map(stockExchangeRepo.findAll(),listType);
        return stockExchangeDtoList;
    }

    @Override
    public StockExchangeDto saveStockExchange(StockExchangeDto stockExchangeDto) {
        mapper.getConfiguration().setMatchingStrategy(MatchingStrategies.STRICT);
        StockExchange result =  stockExchangeRepo.save(mapper.map(stockExchangeDto,StockExchange.class));
        return mapper.map(result,StockExchangeDto.class);
    }

    @Override
    public StockExchangeDto deleteStockExchange(String id) {
        mapper.getConfiguration().setMatchingStrategy(MatchingStrategies.STRICT);
        StockExchangeDto result =  mapper.map(stockExchangeRepo.findById(id).get(),StockExchangeDto.class);
        stockExchangeRepo.deleteById(id);
        return result;
    }

    @Override
    public boolean existsById(String id) {
        return stockExchangeRepo.existsById(id);
    }

    @Override
    public boolean existsByStockExchange(String stockExchange) {
        return stockExchangeRepo.existsByStockExchange(stockExchange);
    }
}
